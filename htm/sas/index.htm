<script src="[JS]/propios/pacientes.js"></script>
<script src="[JS]/propios/medicos.js"></script>
<script src="[JS]/propios/obras_sociales.js"></script>
<script src="[JS]/propios/mensajes.js"></script>


<style>
.ui-autocomplete {
	max-height: 200px;
	overflow-y: auto;
	/* prevent horizontal scrollbar */
	overflow-x: hidden;
}
/* IE 6 doesn't support max-height
* we use height instead, but this forces the menu to always be this tall
*/
* html .ui-autocomplete {
	height: 100px;
}

.panel_medicos{
	width:70%;
	float:left	
}

.panel_paciente{
	width:30%;
	float:left	
}

#panel_menu{
	position:relative;	
}

#panel_menu div{
	display:none
}

#panel_menu a#btn_mostrar{
	min-width: 10%;
	width:20px;
	padding:5px;
	position:absolute;
	bottom:-6px;
	right:10%;
	background:#fff	
}

#form_inhabilitado #desde, #form_inhabilitado #hasta{
	width:70%	
}

#myChat,
#myChat *{
    font-size:16px;
    margin:0;
    padding:0;
}
#myChat h3{
    font-size:19.2px;
    line-height:19.2px;
}
#myChat b{
    color:#999999;
    font-weight:lighter;
    font-size:12px;
    display:block;
    height:13px;
}
#myChat strong{
    color:#007FA6;
}
</style>
<script>
	$(document).ready(function(){
		
		//BOTON INHABILITAR
		$("#inhabilitar").click(function(e){
			e.preventDefault();
			
			if (($("#desde").val().length > 0) && ($("#hasta").val().length > 0) ){
				var date = $("#agenda").datepicker('getDate');
				
				day  = date.getDate(),  
				month = date.getMonth() + 1,              
				year =  date.getFullYear();
				var fecha = year + '-' + month + '-' + day;
				
				var variables = $("#form_inhabilitado").serialize();
				variables += "&medico=" + $("#id_medico").val() + "&especialidad=" + $("#medicos_especialidades").val() + "&fecha=" + fecha;
				$.ajax({  
					type: "POST",   
					url: "[URL]ajax/altas.php",
					data: {variables: variables, tabla: "horarios_inhabilitados"}, 
					beforeSend: function() {
						$("#mje").html("Enviando información...");
					},
					success: function(requestData){
						var rta = requestData;
						//alert (rta);
						alert ('Horarios Inhabilitados Correctamente');
						GrillaInicial(date);
						
					},
					complete: function(requestData, exito){},
					error: function (){
						alert ("Ocurri&oacute; un error. Vuelva a Intentarlo.");
					}
				});	
			}else{
				alert ('Debe ingresar hoarario DESDE y HASTA para inhabilitar turnos.')	
			}
			
		});
		
	});
	
	
	$(document).ready(function(){
		$('#btn_mostrar').click(function(event){
            event.preventDefault();		  
			var $div = $('#panel_menu div');
			var $boton = $('#btn_mostrar');
			
			if ($div.is(':visible')) {
				$div.slideUp();
				$boton.html('Mostrar');
			} else {
				$div.slideDown();
				$boton.html('Ocultar');
			}
		})

		$("#medicos").focus(function(){
			$(this).val('');
		})
		
		$("#dni").focus(function(){
			$(this).val('');
		})

        /** CHAT **
        setInterval(function doMyChat(){
            $.ajax({
                url: "../blab_im_free/my_chat.php",
                context: document.body
            }).done(function(data) {
                $('#myChat').html(data);
            });
        }, 11111);
        $.ajax({
            url: "../blab_im_free/my_chat.php",
            context: document.body
        }).done(function(data) {
            $('#myChat').html(data);
        });
        /** **** **/

	});
	
	jQuery(function($){
	   $("#desde").mask("99:99");
	   $("#hasta").mask("99:99");
	});

	//CARGO LA FUNCION DE HORA ACTUAL (mi_script.js)
  	window.onload = HoraActual
</script>
<section class="bg_negro">
	<div class="container">
    	<div class="row" id="datos_usr">
        	<div class="span6">
        	Bienvenido/a [USUARIO_APELLIDOS], [USUARIO_NOMBRES]
            <a href="login.php">[Cerrar Sesi&oacute;n]</a>
            </div>
            <div id="fecha_hora_actual" class="span6">
            	<span>[FECHA]</span>  -  <span id="liveclock" ></span>
            </div>
        </div>
    </div>
</section>
<section id="panel_menu" class="bg_verde">
	[MENU_TABLAS]
    <a id="btn_mostrar" class="btn" href="#">Mostrar Men&uacute;</a>
</section>

<section id="panel_busqueda" class="bg_azul">
    <div class="container">
    	<div class="row">
            <div class="span4">
                <input id="medicos" type="text" placeHolder="Medico">
                <input type="hidden" id="id_medico">
            </div>
            <div class="span4">
                <div id="contenedor_drop_especialidades"></div>
            </div>
            <div class="span4">
                <input id="dni" type="text" onkeypress="return SoloNros(event)" placeHolder="Paciente">
                <a href="#" id="btn_buscar_paciente" class="btn">Buscar</a>
                <a href="#" class="btn btn_tabla" data-nombre="pacientes">Nuevo</a>
            </div>
            
        </div>
   	</div>
</section>

<section id="panel_cuerpo">
	<div class="container">
    	<div class="row">
            <div class="span3">
            	
                <div class="row">
                	<div id="contenedor_agenda" class="span3 contenedor" style="margin-bottom:10px;">
                    </div>
                </div>
                <div class="row">
                	<div id="contenedor_paciente" class="span3 contenedor" >
                    </div>
                </div>
                <div id="mensajes_nuevos">
                    <div id="myChat"></div>
                </div>
            </div>
            <div class="span9">
            	<div class="row">
                    <div id="cont_grilla_turnos">
                        <form action="index.php" method="post">
                            Desde: <input type="date" name="desde" value="[DATE_DESDE]" style="width:150px;" />                        
                            Hasta: <input type="date" name="hasta" value="[DATE_HASTA]" style="width:150px;" />
                            <input type="submit" value="ok"/>                            
                        </form>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
google.charts.load('current', {'packages':['corechart']});

google.charts.setOnLoadCallback(drawBar1Chart);
function drawBar1Chart() {
    var dataBar1 = google.visualization.arrayToDataTable([
        ['', 'Otorgados', { role: 'style' }]
        [DATA_TURNOS_OTORGADOS_TOTALES]
    ]);
    var options = {
        title: 'TURNOS OTORGADOS TOTALES\nDesde [DATE_DESDE_TEXT] Hasta [DATE_HASTA_TEXT]',
        legend: {position: 'none'},
    };
    var chart = new google.visualization.BarChart(document.getElementById('bar1chart'));
    chart.draw(dataBar1, options);
}

google.charts.setOnLoadCallback(drawBar2Chart);
function drawBar2Chart() {
    var dataBar2 = google.visualization.arrayToDataTable([
        ['', 'Otorgados', { role: 'style' }]
        [DATA_TURNOS_POR_MEDICOS]
    ]);
    var options = {
        title: 'TURNOS POR MEDICOS\nDesde [DATE_DESDE_TEXT] Hasta [DATE_HASTA_TEXT]',
        legend: {position: 'none'},
    };
    var chart = new google.visualization.BarChart(document.getElementById('bar2chart'));
    chart.draw(dataBar2, options);
}

google.charts.setOnLoadCallback(drawLineChart);
function drawLineChart() {
    var dataLine = google.visualization.arrayToDataTable([
        ['', 'Otorgados', { role: 'style' }]
        [DATA_TURNOS_OTORGADOS_POR_DIA]
    ]);
    var options = {
        title: 'TURNOS OTORGADOS POR DÍA\nDesde [DATE_DESDE_TEXT] Hasta [DATE_HASTA_TEXT]',
        legend: {position: 'none'},
    };
    var chart = new google.visualization.LineChart(document.getElementById('linechart'));
    chart.draw(dataLine, options);
}
</script>
<div id="bar1chart" style="width: 100%; height: 270px;"></div>
<div id="bar2chart" style="width: 100%; height: 270px;"></div>
<div id="linechart" style="width: 100%; height: 270px;"></div>
                    </div>
                    <div class="span3 contenedor" id="habilitar_inhabilitar" >
                        <div class="inner">
                            <h3>Inhabilitar</h3>
                            <div class="clear"></div>
                            <form id="form_inhabilitado" name="form_inhabilitado">
                                <div style="display:inline-block; width:40%; vertical-align:top">
                                    Desde: <input type="text" id="desde" name="desde" />
                                </div>
                                <div style="display:inline-block; width:40%; vertical-align:top">
                                    Hasta: <input type="text" id="hasta" name="hasta" />
                                </div>
                                <div style="display:inline-block; width:18%; vertical-align:top">
                                    
                                    <a href='#' id="inhabilitar" class='btn'>Inhabilitar</a>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="span3 contenedor" id="cont_duplicados" >
                        <div class="inner">
                            <h3>Duplicados</h3>
                            <div id="duplicados"></div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
	</div>
</div>

<div id="dialog_eliminar" title="Borrar Registos Seleccionado?">
    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>Se borrar&aacute;n todos los datos vinculados al registro. Desea continuar?</p>
</div>